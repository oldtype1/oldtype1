<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="inn">

<resultMap type="ivo" id="innResult">
	<result property="innNo" column="inn_no"/>
	<result property="innName" column="inn_name"/>
	<result property="innCity" column="inn_city"/>
	<result property="innArea" column="inn_area"/>
	<result property="innAddress" column="inn_address"/>
	<result property="innType" column="inn_type"/>
	<result property="acceptableNo" column="inn_acceptable_no"/>
	<result property="innPrice" column="inn_price"/>
	<result property="innInfo" column="inn_info"/>
	<result property="innAvailability" column="inn_availability"/>
	<result property="memberId" column="member_id"/>
</resultMap>
<resultMap type="bvo" id="bookResult">
<result property="bookNo" column="book_no"/>
<result property="bookCheckIn" column="book_checkin"/>
<result property="bookCheckOut" column="book_checkout"/>
<result property="bookCount" column="book_count"/>
<result property="memberId" column="member_id"/>
<result property="innNo" column="inn_no"/>
<result property="innName" column="inn_name"/>
</resultMap>
<resultMap type="wvo" id="wishListResult">
<result property="wishListNo" column="wishlist_no"/>
<result property="memberId" column="member_id"/>
<result property="innNo" column="inn_no"/>
<result property="innName" column="inn_name"/>
</resultMap>


	<sql id="innlist">
		select inn_no,inn_name,inn_city,inn_area,inn_address,inn_type,inn_acceptable_no,
		inn_price,inn_info,inn_availability,member_id from inn
	</sql>
	
	<select id="getmyinnlist" parameterType="hashmap" resultType="ivo" resultMap="innResult">
select inn_no,inn_name,inn_city,inn_area,inn_address,inn_type,inn_acceptable_no,
		inn_price,inn_info,inn_availability,member_id from	
		(
 select  inn_no,inn_name,inn_city,inn_area,inn_address,inn_type,inn_acceptable_no,
		inn_price,inn_info,inn_availability,member_id,ceil(rownum/5) as page
 from
 (
  select  inn_no,inn_name,inn_city,inn_area,inn_address,inn_type,inn_acceptable_no,
		inn_price,inn_info,inn_availability,member_id from inn where member_id=#{member_id}
		order by inn_no desc	
 )
 )   where page=#{pageNo} 
	</select>
	
	 <select id="getTotalPostingCount" resultType="int" parameterType="String">
 	select count(*) from inn where member_id=#{value}
 	</select>
 	
	<select id="selectInnByCityAndAcceptableNo" parameterType="svo" resultType="ivo" resultMap="innResult">
		<include refid="innlist" />
		where inn_city=#{innCity} and inn_acceptable_no=#{acceptableNo}
	</select>
	
		<select id="selectInnByCheckedAmenity" parameterType="avo" resultType="ivo" resultMap="innResult">
		select inn_no, inn_name, inn_city, inn_area, inn_address, inn_type, inn_acceptable_no, 
inn_price, inn_info,inn_availability,member_id from (select i.inn_no, i.inn_name, i.inn_city, i.inn_area, i.inn_address, i.inn_type, i.inn_acceptable_no, 
i.inn_price, i.inn_info,i.inn_availability,i.member_id, a.amenity_wifi,a.amenity_bed,a.amenity_tv,a.amenity_kitchen,a.amenity_bbq, a.amenity_no
from inn i, amenity a where i.inn_no=a.amenity_no)
where amenity_wifi=#{amenityWiFi} and amenity_bed=#{amenityBed} and amenity_tv=#{amenityTV} and amenity_kitchen=#{amenityKitchen} and amenity_bbq=#{amenityBBQ}
	</select>
	
	<select id="selectInnByCityAndDateAndAcceptableNo" parameterType="svo" resultType="ivo" resultMap="innResult">
	<![CDATA[select distinct inn_no, inn_name, inn_city, inn_area, inn_type, inn_acceptable_no, inn_price, member_id
from (select * from (select i.inn_no, i.inn_name, i.inn_city, i.inn_area, i.inn_address, i.inn_type, i.inn_acceptable_no, 
i.inn_price, i.inn_info,i.inn_availability,i.member_id, a.availabledate_st, a.availabledate_end from availabledate a, inn i 
where i.inn_no=a.inn_no)
where availabledate_st>= #{startDate} and availabledate_end <= #{endDate})
where inn_city=#{innCity} and inn_acceptable_no=#{acceptableNo}]]>
	</select>
	
		<select  id="getmybooklist" parameterType="hashmap" resultType="bvo" resultMap="bookResult">
	 select book_no, book_checkin, book_checkout, book_count, member_id, inn_no, inn_name from(
 select book_no, book_checkin, book_checkout, book_count, member_id, inn_no, inn_name, page from(
 select b.book_no, b.book_checkin, b.book_checkout, b.book_count, b.member_id, b.inn_no, i.inn_name, ceil(rownum/5) as page from book b, inn i 
 where b.inn_no=i.inn_no
 ) where member_id=#{member_id}
 ) where page=#{pageNo} 
	</select>
	
		<select id="getmywishlist" parameterType="hashmap" resultType="wvo" resultMap="wishListResult">
	 select inn_no, wishlist_no, member_id, inn_name from(
 select  inn_no, wishlist_no, member_id, inn_name, page from(
 select i.inn_no, w.wishlist_no, w.member_id, i.inn_name, ceil(rownum/5) as page from wishlist w, inn i 
 where i.inn_no=w.inn_no
 ) where member_id=#{member_id}
 ) where page=#{pageNo}
	</select>
	<delete id="wishListDelete" parameterType="wdvo">
	 delete from wishlist where member_id=#{memberId} and wishlist_no=#{wishListNo}
	</delete>
		<delete id="bookDelete" parameterType="bdvo">
	 delete from book where member_id=#{memberId} and book_no=#{bookNo}
	</delete>
	
<insert id="register" parameterType="ivo" >
	 <selectKey keyProperty="innNo"  resultType="int"  order="BEFORE">
       select inn_sequence.nextval from dual
   </selectKey>
	insert into INN
	(inn_no, inn_name, inn_city, inn_area, inn_address, inn_type, inn_acceptable_no, 
	inn_price, inn_info,inn_availability,member_id) 
	values(#{innNo},#{innName},#{innCity},#{innArea},#{innAddress},#{innType},
	#{acceptableNo},#{innPrice},#{innInfo},#{innAvailability},#{memberId})
	</insert>
	<select id="select_inn_by_member_id" resultMap="innResult" parameterType="ivo">
	select inn_no, inn_name, inn_city, inn_area, inn_address, inn_type, inn_acceptable_no, 
	inn_price, inn_info,inn_availability,member_id from INN where member_id=#{memberId} 
	</select>
	
	
	<!-- <select id="getAddressKind" resultType="string">
		select distinct(address) from member
	</select>
	<select id="findByAddress" resultType="mvo">
		<include refid="selectMember" />
		where address=#{value}
	</select>
	<select id="findMemberById" resultType="mvo">
		<include refid="selectMember" />
		where id=#{value}
	</select>
	<insert id="registerMember" parameterType="mvo">
		insert into member(id,password,name,address)
		values(#{id},#{password},#{name},#{address})
	</insert>
	<select id="idcheck" resultType="int">
		select count(*) from member where id=#{value}
	</select>
	<update id="updateMember" parameterType="mvo">
		update member set password=#{password},name=#{name},address=#{address}
		where id=#{id}
	</update> -->
</mapper>
 
 
 
 
 
 
 
 
 
















